<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>KrISS Klok</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAEQAAABEAAAARAAARAAAAAAARABEAEAAAABEAABEAAAAAAAAAEQARAAAAABEAEQAQAAAAEQARABAAAAAAEQARAAAAAAARAAAAAAAAEQAAAAAAEQARAAAAAAARAAARAAAAEQAAABEAAAARAAAAAAAAAAAAABgAAAAYAAAAPAAAADwAAAAYAAAAAAAAAADAAAAB8AAAAfAAAADAAAAAAAAAGAAAADwAAAA8AAAAGAAAABgAAA">
    <style>body{margin:0;position:relative;}#board{display:flex;width:100vw;height:100vh;}#options{position:absolute;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0.42,0.42,0.42,0.42);display:none;animation-duration:0.24s;}#options > div{position:absolute;width:calc(100vw - 84px);height:calc(100vh - 84px);top:42px;left:42px;background-color:#fff;overflow:auto;}#options > div > span.options{display:block;width:42px;height:42px;position:absolute;top:0;right:0;line-height:42px;text-align:center;font-size:large;cursor:pointer;}#board.portrait{flex-direction:column;}.timer{justify-content:center;align-items:center;display:flex;width:100%;height:100%;font-size:xx-large;}.sep{background-color:black;width:6px;height:100%;position:relative;min-height:1px;}.portrait .sep{width:100%;height:6px;}.sep .action{position:absolute;width:48px;height:48px;background-color:blue;top:0;left:-24px;text-align:center;line-height:42px;font-size:36px;cursor:pointer;}.sep .options{position:absolute;width:48px;height:48px;background-color:red;bottom:0;left:-24px;text-align:center;line-height:42px;font-size:36px;cursor:pointer;}.portrait .sep .action{top:-24px;left:0;}.portrait .sep .options{top:-24px;bottom:initial;left:initial;right:0;}</style>
    <style>@charset "UTF-8";/*!* animate.css - https://animate.style/* Version - 4.1.1* Licensed under the MIT license - http://opensource.org/licenses/MIT** Copyright (c) 2020 Animate.css*/:root{--animate-duration:1s;--animate-delay:1s;--animate-repeat:1}.animate__animated{-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-duration:var(--animate-duration);animation-duration:var(--animate-duration);-webkit-animation-fill-mode:both;animation-fill-mode:both}.animate__backInDown{-webkit-animation-name:backInDown;animation-name:backInDown}@-webkit-keyframes backInDown{0%{-webkit-transform:translateY(-1200px) scale(.7);transform:translateY(-1200px) scale(.7);opacity:.7}80%{-webkit-transform:translateY(0) scale(.7);transform:translateY(0) scale(.7);opacity:.7}to{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@keyframes backInDown{0%{-webkit-transform:translateY(-1200px) scale(.7);transform:translateY(-1200px) scale(.7);opacity:.7}80%{-webkit-transform:translateY(0) scale(.7);transform:translateY(0) scale(.7);opacity:.7}to{-webkit-transform:scale(1);transform:scale(1);opacity:1}}.animate__backInDown{-webkit-animation-name:backInDown;animation-name:backInDown}</style>
    <script>let klok = {"orientation": "auto","timer": 2,"time": 60, /* s */"interval": 61, /* ms */};let timers = [];function getOrientation() {switch(klok['orientation']) {case "landscape":case "portrait":return klok['orientation'];case "auto":default:return window.innerWidth > window.innerHeight ? "landscape" : "portrait";}}function updateOrientation() {let orientation = getOrientation();if (!board.classList.contains(orientation)) {board.classList.remove("landscape");board.classList.remove("portrait");board.classList.add(orientation);}}function addTimer(time, interval) {let timerElt = document.createElement('div');timerElt.classList.add('timer');let timer = new Timer((t) => { timerElt.innerText = t.getTime(); },time,interval);timerElt.onclick = () => {let currentIndex = timers.indexOf(timer);if (timer.state === 1|| (timers.filter((t) => t.state !== 1)).length == timers.length) {timer.pause();timers[(currentIndex+1)%(timers.length)].resume();}};if (board.children.length != 0) {let sepElt = document.createElement('div');sepElt.classList.add('sep');let sepActionElt = document.createElement('div');sepActionElt.classList.add('action');sepActionElt.onclick = clickAction;sepActionElt.innerText = "âŸ³";let sepOptionsElt = document.createElement('div');sepOptionsElt.classList.add('options');sepOptionsElt.onclick = clickOptions;sepOptionsElt.innerText = "âš™";sepElt.appendChild(sepActionElt);sepElt.appendChild(sepOptionsElt);board.appendChild(sepElt);}board.appendChild(timerElt);return timer;}function toggleAction() {document.querySelectorAll('.action').forEach((elt) => {if (getIsAllPaused()) {elt.innerText = "âŸ³";} else {elt.innerText = "â¸";}});}function getIsAllPaused() {let isAllPaused = true;timers.forEach((timer) => {if (timer.state === 1) {isAllPaused = false;}});return isAllPaused;}function clickAction() {let isAllPaused = getIsAllPaused();if (isAllPaused) {if (confirm('reset?')) {timers.forEach((timer) => {timer.stop();timer.init();});}} else {timers.forEach((timer) => {timer.pause();});}}function clickOptions(evt) {if (evt.target.classList.contains('options') || evt.target.id == "options") {const options = document.getElementById('options');if (options.style.display != "block") {options.style.display = "block";} else {options.style.display = "none";}}}function updateTimer() {timers = [];board.innerHTML = '';initTimer();}function initTimer() {for(let i = 0; i < klok['timer']; i++) {timers[i] = addTimer(klok['time'], klok['interval']);}}function loadOptions() {klok['orientation'] = localStorage.getItem("orientation") || klok['orientation'];klok['timer'] = localStorage.getItem("timer") || klok['timer'];klok['time'] = localStorage.getItem("time") || klok['time'];klok['interval'] = localStorage.getItem("interval") || klok['interval'];document.querySelector('input[name="orientation"][value="'+klok['orientation']+'"]').checked = "checked";document.querySelectorAll('input[name="orientation"]').forEach((elt) => {elt.onclick = function() {klok['orientation'] = elt.value;localStorage.setItem("orientation", elt.value);updateOrientation();};});const timerElt = document.querySelector('input[name="timer"]');timerElt.value = klok['timer'];timerElt.oninput = function() {klok['timer'] = timerElt.value;localStorage.setItem("timer", timerElt.value);updateTimer();};const timeElt = document.querySelector('input[name="time"]');timeElt.value = klok['time'];timeElt.oninput = function() {klok['time'] = timeElt.value;localStorage.setItem("time", timeElt.value);updateTimer();};const intervalElt = document.querySelector('input[name="interval"]');intervalElt.value = klok['interval'];intervalElt.oninput = function() {klok['interval'] = intervalElt.value;localStorage.setItem("interval", intervalElt.value);updateTimer();};}screen.orientation.onchange = updateOrientation;window.onresize = updateOrientation;window.onload = () => {"use strict";const board = document.getElementById('board');const options = document.getElementById('options');options.onclick = clickOptions;loadOptions();updateOrientation();initTimer();};function Timer(callback, time, interval) {this.callback = callback;this.interval = interval; /* ms */this.initialTime = time; /* s */this.time = time * 1000; /* s */this.state = 0; /*  0 = idle, 1 = running, 2 = paused */this.proxyCallback = () => {this.time = this.time - this.interval;if(this.time <= 0){this.stop();return;}this.callback(this);};this.init = () => {this.time = this.initialTime * 1000;this.setState(0);this.callback(this);};this.pause = () => {if (this.state != 1) return;clearInterval(this.timerId);this.setState(2);};this.resume = () => {if (this.state != 0 && this.state != 2) return;this.timerId = setInterval(() => this.proxyCallback(), this.interval);this.setState(1);};this.stop = () => {if (this.state === 0) return;this.time = 0;clearInterval(this.timerId);this.callback(this);this.setState(0);};this.getTime = () => {const date = new Date(this.time);let min = (''+date.getMinutes()).padStart(2,'0');let sec = (''+date.getSeconds()).padStart(2,'0');let mil = (''+date.getMilliseconds()).padStart(3,'0');return `${min}:${sec}.${mil}`;};this.setState = (state) => {this.state = state;toggleAction();};this.callback(this);}</script>
  </head>
  <body>
    <div id="board" class="portrait"></div>
    <div id="options" class="animate__animated animate__backInDown">
      <div>
        <h1>Settings</h1>
        <fieldset>
          <legend>Orientation</legend>
          <label><input type="radio" name="orientation" value="landscape">Landscape</label>
          <label><input type="radio" name="orientation" value="portrait">Portrait</label>
          <label><input type="radio" name="orientation" value="auto">Auto</label>
        </fieldset>
        <fieldset>
          <legend>Timer</legend>
          <label>Number of timers: <input type="range" name="timer" value="2" min="2" max="10"></label><br>
          <label>Time in seconds: <input type="number" name="time" value="60"></label><br>
          <label>Interval in milliseconds: <input type="number" name="interval" value="61"></label>
        </fieldset>
        <span class="options">ðŸ—™</span>
      </div>
    </div>
  </body>
</html>
